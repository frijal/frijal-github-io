<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate artikel.json Otomatis</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f5f5f5; }
h1 { text-align:center; }
textarea { width:100%; height:200px; padding:10px; font-family: monospace; font-size:13px; }
button { padding:10px 15px; font-size:14px; margin-top:10px; cursor:pointer; margin-right:8px; }
#log { background:#111; color:#0f0; padding:10px; height:350px; overflow-y:auto; font-family: monospace; font-size:13px; margin-top:15px; border-radius:4px; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>Generate artikel.json Otomatis</h1>
<p>JSON muncul di bawah. Download, copy, atau push manual ke repo.</p>
<textarea id="jsonOutput" readonly></textarea>
<br>
<button id="downloadBtn">‚¨áÔ∏è Download JSON</button>
<button id="copyBtn">üìã Copy JSON</button>
<button id="refreshBtn">üîÑ Refresh Scan</button>
<button id="clearLogBtn">üßπ Clear Log</button>

<h3>Verbose Log</h3>
<div id="log"></div>

<script>
// --- Fungsi kategori berdasarkan keyword ---
function titleToCategory(title){
  const t = title.toLowerCase();
  const cats = [
    {name: "Arch", k:["arch","manjaro","cachyos","endeavouros","artix","parabola","blackarch","garuda","antergos","arco"]},
    {name: "Debian", k:["debian","ubuntu","mint","mx linux","elementary","puppy","kali","kubuntu","xubuntu","lubuntu","zorin","popos","deepin","tails","raspbian","devuan"]},
    {name: "Desktop", k:["kde","hyperland","caja","ukui","pantheon","deepin","lxde","budgie","mate","gnome","cinnamon","xfce","desktop environment","fluxbox","openbox","i3","sway","awesome","dwm","enlightenment","wayland","xorg","window manager"]},
    {name: "Kehidupan", k:["hidup","uang","dosa","alasan","bapak","ibu","anak","kehidupan","tidur","sahabat","teman","sombong","wanita","pria","perempuan","laki","silaturahim","daily","rutinitas","bahagia","sedih","cinta","emosi","keluarga","sosial","masalah","motivasi","inspirasi","tujuan","rencana","kebiasaan","jodoh","nikah"]},
    {name: "Kerja", k:["kerja","kantor","dokumen","strategi","pdf","psikotes","karir","bisnis","proyek","meeting","wawancara","resign","gaji","promosi","lembur","freelance","startup","cv","lamaran","manajemen","produktivitas"]},
    {name: "Kuliner", k:["resep","makan","minum","bumbu","kuliner","masak","restoran","kafe","jajanan","sarapan","makan siang","makan malam","diet","makanan","minuman","dapur","kue","roti","gorengan"]},
    {name: "Multimedia", k:["video","foto","audio","film","ffmpeg","imagemagick","photoshop","gimp","audacity","blender","premiere","davinci","lightroom","kdenlive","shotcut","editing","produksi","musik","podcast","vfx","efek"]},
    {name: "NixOS", k:["nixos","nix"]},
    {name: "OpenSUSE", k:["opensuse","suse","leap","tumbleweed","chameleon","zypper"]},
    {name: "OS Linux", k:["grub","oss","lts","open source","autoremove","cron","reinstall","dd","troubleshooting","skrip","rsync","systemd","sudo","backup","plugin","ssh","symlinks","mount","samba","linux","bootloader","distro","release","rilis","kernel","cli","shell","bash","zsh","init","pacman","yay","apt-get","dpkg","yum","dnf","zypper","aptitude","uname","ls","grep","awk","sed","chmod","chown","user","group","service","systemctl"]},
    {name: "OS Windows", k:["windows","windows 10","windows 11","powershell","cmd","registry","boot","update","explorer","task manager","bsod","driver"]},
    {name: "Redhat", k:["fedora","centos","redhat","rhel","scientific linux","alma","rocky","centos stream"]},
    {name: "Religi", k:["allah","shalat","sholat","agama","puasa","nabi","islam","madinah","religi","ghibah","muslim","quran","hadits","dakwah","doa","surga","neraka","masjid","iman","ibadah","hijab","akidah"]},
    {name: "Repository", k:["repository","dnf","apt","repo","snap","synaptic","octopi","flatpak","netselect","mirror","reflector","aur","ppa","github","gitlab","bitbucket","dockerhub","git","clone","push","pull"]},
    {name: "Slackware", k:["slackware","slac","sbopkg","pkgtools"]},
    {name: "Jaringan", k:["jaringan","internet","wifi","router","modem","ethernet","ip address","dns","firewall","tcp","udp","http","https","proxy","vpn","port","lan","wan","bandwidth","ping","traceroute"]},
    {name: "Pemrograman", k:["pemrograman","program","coding","javascript","python","php","java","c++","c","html","css","database","sql","mysql","mongodb","framework","library","api","bug","compiler","debugging","syntax","variabel","algoritma","frontend","backend","fullstack","data science"]},
    {name: "Perangkat Keras", k:["perangkat keras","hardware","cpu","gpu","ram","hardisk","ssd","motherboard","power supply","monitor","keyboard","mouse","printer","usb","driver","bios","uefi","processor","graphic card","storage","komponen"]},
    {name: "Keuangan", k:["keuangan","investasi","saham","crypto","bitcoin","uang","bank","tabungan","kredit","pinjaman","pajak","anggaran","ekonomi","fintech","reksadana","inflasi","utang"]}
  ];
  return (cats.find(c=>c.k.some(k=>t.includes(k)))||{name:"Lainnya"}).name;
}

// --- Konfigurasi repo GitHub Pages publik ---
const owner = "frijal";       
const repo = "frijal.github.io";  
const folder = "artikel";     

function log(msg){
  const logBox = document.getElementById("log");
  logBox.textContent += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

async function generateJSON() {
  try {
    document.getElementById("jsonOutput").value = "";
    log("üîç Mengambil daftar file dari repo...");
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;
    const res = await fetch(apiUrl);
    const files = await res.json();
    const htmlFiles = files.filter(f => f.name.endsWith(".html"));
    log(`üìÇ Ditemukan ${htmlFiles.length} file HTML`);

    const grouped = {};
    const seenTitles = new Set();
    let success=0, fail=0, skipped=0;

    for (const f of htmlFiles) {
      log(`‚û°Ô∏è Membaca file: ${f.name}`);
      try {
        const htmlText = await fetch(f.download_url).then(r=>r.text());
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText,'text/html');
        const title = doc.querySelector("title")?.innerText || f.name;

        if(seenTitles.has(title)){
          skipped++;
          log(`   ‚ö†Ô∏è Duplikat judul, diskip: "${title}"`);
          continue;
        }

        const category = titleToCategory(title);
        if (!grouped[category]) grouped[category] = [];
        grouped[category].push([title, f.name]);
        seenTitles.add(title);
        success++;
        log(`   ‚úîÔ∏è Berhasil ‚Üí "${title}" | Kategori: ${category}`);
      } catch(e) {
        fail++;
        log(`   ‚ùå Gagal membaca file: ${f.name}`);
        if (!grouped["Lainnya"]) grouped["Lainnya"] = [];
        grouped["Lainnya"].push([f.name, f.name]);
      }
    }

    // Format JSON multi-baris
    function jsonPrettyByCategory(obj){
      return '{\n' + 
        Object.keys(obj).map(cat =>
          `  "${cat}": \n  [\n` +
          obj[cat].map(a => `    ["${a[0]}","${a[1]}"]`).join(',\n') +
          '\n  ]'
        ).join(',\n') + '\n}';
    }

    const resultJSON = jsonPrettyByCategory(grouped);
    document.getElementById("jsonOutput").value = resultJSON;

    log("\nüìä Ringkasan per kategori:");
    Object.entries(grouped)
      .sort((a,b) => b[1].length - a[1].length)
      .forEach(([cat, arr])=>{
        log(`   - ${cat}: ${arr.length} item`);
      });

    log(`\nüìà Total sukses: ${success}, gagal: ${fail}, duplikat diskip: ${skipped}`);
    log("\n‚úÖ Proses selesai! JSON siap diunduh / dicopy.");
  } catch(err){
    log("‚ùå Error: " + err.message);
    document.getElementById("jsonOutput").value = "Error: " + err.message;
  }
}

// Tombol download
document.getElementById("downloadBtn").addEventListener("click", ()=>{
  const blob = new Blob([document.getElementById("jsonOutput").value], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "artikel.json";
  a.click();
  URL.revokeObjectURL(url);
});

// Tombol copy
document.getElementById("copyBtn").addEventListener("click", async ()=>{
  try {
    await navigator.clipboard.writeText(document.getElementById("jsonOutput").value);
    log("üìã JSON berhasil dicopy ke clipboard!");
  } catch(err){
    log("‚ùå Gagal copy JSON: " + err.message);
  }
});

// Refresh
document.getElementById("refreshBtn").addEventListener("click", ()=>{
  document.getElementById("log").textContent = "";
  generateJSON();
});

// Clear log
document.getElementById("clearLogBtn").addEventListener("click", ()=>{
  document.getElementById("log").textContent = "";
});

// Auto jalan
generateJSON();
</script>

</body>
</html>
