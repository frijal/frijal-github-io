<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Artikel JSON - Final</title>
<style>
body { font-family: Arial,sans-serif; margin:0; background:#f9f9f9; color:#333; }

.header { position:sticky; top:0; z-index:1000; background:#fff; padding:15px 10px; display:flex; align-items:center; justify-content:space-between; }
.header-left { display:flex; align-items:center; gap:15px; }
.header h1 { margin:0; font-size:22px; color:#007bff; }
.stats { font-weight:bold; font-size:16px; }

.search-container { display:flex; align-items:center; gap:5px; }
.search-container input { padding:8px 12px; width:300px; font-size:15px; border:1px solid #ccc; border-radius:5px; }
.search-container button { padding:8px 12px; font-size:14px; border:none; border-radius:5px; background:#dc3545; color:#fff; cursor:pointer; }
.search-container button:hover { background:#b02a37; }

.header-right { display:flex; align-items:center; gap:10px; }
#downloadJSONBtn { padding:8px 12px; background:#007bff; color:#fff; border:none; border-radius:5px; cursor:pointer; font-size:14px; position:relative; }
#downloadJSONBtn:hover { background:#0056b3; }
#downloadJSONBtn[hidden] { display:none; }

[data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute; bottom:120%; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.75); color:#fff; padding:4px 8px; border-radius:4px; font-size:12px; white-space:nowrap; z-index:1001;
}

#dashboard { display:grid; grid-template-columns:1fr 1fr; gap:20px; padding:20px; }
.category { background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; position:relative;}
.category h2 { margin:0; padding:10px; background:#007bff; color:#fff; border-radius:8px 8px 0 0; font-size:18px; display:flex; justify-content:flex-start; align-items:center; gap:5px;}
.category h2 span.count { font-size:14px; font-weight:normal; background:rgba(255,255,255,0.2); padding:2px 8px; border-radius:12px; }

.articles { display:flex; flex-wrap:wrap; gap:15px; padding:15px; min-height:50px; border:2px dashed transparent; transition:0.2s; position:relative; }
.articles.drag-over { border-color:#007bff; background:#eaf4ff; }

.card { background:#fafafa; border:1px solid #ddd; border-radius:6px; width:200px; overflow:hidden; display:flex; flex-direction:column; cursor:grab; user-select:none; position:relative; }
.card.selected { border:2px solid #007bff; background:#eaf4ff; }

.card img { width:100%; height:120px; object-fit:cover; background:#eee; }
.card .title { padding:10px; font-size:14px; font-weight:bold; flex-grow:1; }
.card mark { background:yellow; padding:0 2px; border-radius:2px; }

.selection-rectangle { position:absolute; border:2px dashed #007bff; background:rgba(0,123,255,0.1); pointer-events:none; z-index:10000; }
#dragTooltip { position:absolute; pointer-events:none; background:rgba(0,123,255,0.8); color:#fff; padding:4px 8px; border-radius:4px; font-size:12px; z-index:10001; display:none; }
button.cutPasteBtn { font-size:12px; padding:2px 5px; cursor:pointer; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <h1>Dashboard Artikel JSON</h1>
    <div id="totalStats" class="stats">Total Artikel: 0</div>
  </div>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Cari artikel...">
    <button id="resetSearch">X</button>
  </div>
  <div class="header-right">
    <button id="downloadJSONBtn" hidden data-tooltip="Download semua data artikel JSON">Download JSON</button>
  </div>
</div>

<div id="dashboard"></div>
<div id="dragTooltip"></div>

<script>
let artikelData={}, defaultThumbnail="../thumbnail.jpg";
let searchQuery="", selectedCards=[], dataChanged=false, clipboard=[];
let marquee=null, dragTooltip=document.getElementById("dragTooltip");

// LOAD DATA
async function loadData(){
  try{ const res=await fetch("../artikel.json"); artikelData=await res.json(); renderDashboard(); }
  catch(e){ alert("Gagal memuat artikel.json: "+e); }
}

// RENDER
function highlightText(text,query){ if(!query)return text; return text.replace(new RegExp(`(${query})`,"gi"),"<mark>$1</mark>"); }

function renderDashboard(){
  const container=document.getElementById("dashboard"); container.innerHTML="";
  const totalStats=document.getElementById("totalStats"); let totalCount=0;
  const categories=Object.keys(artikelData);

  categories.forEach(cat=>{
    const section=document.createElement("div"); section.className="category";
    const h2=document.createElement("h2"); 

    // CUT & PASTE buttons
    const cutBtn=document.createElement("button");
    cutBtn.textContent="âœ‚ï¸"; cutBtn.title="Cut semua artikel kategori ini"; cutBtn.className="cutPasteBtn";

    const pasteBtn=document.createElement("button");
    pasteBtn.textContent="ðŸ“‹"; pasteBtn.title="Paste artikel yang dicut"; pasteBtn.className="cutPasteBtn";

    cutBtn.addEventListener("click", ()=>{
      clipboard=[...artikelData[cat]];
      alert(`Sudah menyalin ${clipboard.length} artikel dari kategori "${cat}"`);
    });
    pasteBtn.addEventListener("click", ()=>{
      if(!clipboard || clipboard.length===0){ alert("Tidak ada artikel yang dicut!"); return; }
      artikelData[cat].push(...clipboard);
      alert(`Telah mem-paste ${clipboard.length} artikel ke kategori "${cat}"`);
      clipboard=[]; dataChanged=true; updateDownloadBtn();
      renderDashboard();
    });

    // Nama kategori setelah Cut & Paste
    const titleSpan=document.createElement("span"); titleSpan.textContent=cat; titleSpan.style.fontWeight="bold"; titleSpan.style.marginLeft="5px";

    // Count span
    const countSpan=document.createElement("span"); countSpan.className="count";

    // Susun h2
    h2.appendChild(cutBtn);
    h2.appendChild(pasteBtn);
    h2.appendChild(titleSpan);
    h2.appendChild(countSpan);

    section.appendChild(h2);

    const articlesDiv=document.createElement("div"); articlesDiv.className="articles"; articlesDiv.dataset.cat=cat;
    articlesDiv.addEventListener("dragover", e=>{ e.preventDefault(); articlesDiv.classList.add("drag-over"); dragTooltip.style.display="block"; dragTooltip.textContent=`Menyeret ${selectedCards.length} artikel terpilih...`; });
    articlesDiv.addEventListener("dragleave", ()=>{ articlesDiv.classList.remove("drag-over"); dragTooltip.style.display="none"; });
    articlesDiv.addEventListener("drop", e=>{
      e.preventDefault(); articlesDiv.classList.remove("drag-over"); dragTooltip.style.display="none";
      const targetCat=articlesDiv.dataset.cat;
      selectedCards.forEach(card=>{
        const fromCat=card.closest(".articles").dataset.cat;
        const title=card.querySelector(".title").textContent;
        const idx=artikelData[fromCat].findIndex(a=>a[0]===title);
        if(idx>-1 && fromCat!==targetCat){ moveArticle(fromCat, idx, targetCat); dataChanged=true; }
      });
      clearSelection(); updateDownloadBtn();
    });

    let sortedArticles=[...artikelData[cat]].sort((a,b)=>b[3]-a[3]);
    if(searchQuery.trim()!==""){ sortedArticles=sortedArticles.filter(item=>{ const title=item[0].toLowerCase(); const file=(item[1]||"").toLowerCase(); return title.includes(searchQuery)||file.includes(searchQuery); }); }
    countSpan.textContent=`(${sortedArticles.length})`; totalCount+=sortedArticles.length;

    sortedArticles.forEach(item=>{
      const [title,fileName,img]=item; const card=document.createElement("div"); card.className="card"; card.draggable=true;
      const image=document.createElement("img"); if(img && /\.(jpe?g|png|gif|webp|avif|svg)$/i.test(img)){ image.src=/^https?:\/\//i.test(img)?img:`../${img}`; } else image.src=defaultThumbnail; image.alt=title; card.appendChild(image);
      const titleDiv=document.createElement("div"); titleDiv.className="title"; titleDiv.innerHTML=highlightText(title,searchQuery); card.appendChild(titleDiv);
      articlesDiv.appendChild(card);
    });

    section.appendChild(articlesDiv);
    container.appendChild(section);
  });

  totalStats.textContent=`Total Artikel: ${totalCount}`;
  addSelectionEvents(); addDragEvents(); addMarqueeSelection(); updateDownloadBtn();
}

// MOVE, DOWNLOAD, SELECTION
function moveArticle(fromCat,idx,toCat){ const article=artikelData[fromCat][idx]; artikelData[fromCat].splice(idx,1); artikelData[toCat].push(article); renderDashboard(); }
function downloadJSON(){ const blob=new Blob([JSON.stringify(artikelData,null,2)],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="artikel.json"; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); dataChanged=false; updateDownloadBtn(); }

document.getElementById("searchInput").addEventListener("input", e=>{ searchQuery=e.target.value.toLowerCase(); renderDashboard(); });
document.getElementById("resetSearch").addEventListener("click", ()=>{ document.getElementById("searchInput").value=""; searchQuery=""; renderDashboard(); });

document.getElementById("downloadJSONBtn").addEventListener("click", downloadJSON);

function clearSelection(){ selectedCards.forEach(c=>c.classList.remove("selected")); selectedCards=[]; }
function addSelectionEvents(){
  document.querySelectorAll(".card").forEach(card=>{
    card.addEventListener("click", e=>{
      if(e.ctrlKey||e.metaKey){
        if(card.classList.contains("selected")){ card.classList.remove("selected"); selectedCards=selectedCards.filter(c=>c!==card); }
        else { card.classList.add("selected"); selectedCards.push(card); }
      } else { clearSelection(); card.classList.add("selected"); selectedCards.push(card); }
    });
  });
}

function updateDownloadBtn(){ document.getElementById("downloadJSONBtn").hidden = !dataChanged; }

// DRAG EVENTS
function addDragEvents(){
  document.querySelectorAll(".card").forEach(card=>{
    card.addEventListener("dragstart", e=>{
      if(!selectedCards.includes(card)){ clearSelection(); card.classList.add("selected"); selectedCards.push(card); }
      e.dataTransfer.setData("text/plain","drag-selected"); e.dataTransfer.effectAllowed="move"; card.style.opacity="0.5";
      dragTooltip.style.display="block"; dragTooltip.textContent=`Menyeret ${selectedCards.length} artikel terpilih...`;
    });
    card.addEventListener("dragend", ()=>{ document.querySelectorAll(".card").forEach(c=>c.style.opacity="1"); dragTooltip.style.display="none"; });
  });
  document.querySelectorAll(".articles").forEach(container=>{
    container.addEventListener("dragover", e=>{ e.preventDefault(); container.classList.add("drag-over"); });
    container.addEventListener("dragleave", ()=>{ container.classList.remove("drag-over"); });
    container.addEventListener("drop", e=>{ e.preventDefault(); container.classList.remove("drag-over"); });
  });
  document.addEventListener("mousemove", e=>{ if(dragTooltip.style.display==="block"){ dragTooltip.style.left=e.pageX+15+"px"; dragTooltip.style.top=e.pageY+15+"px"; } });
}

// MARQUEE SELECTION
function addMarqueeSelection(){
  const dashboard=document.getElementById("dashboard");
  let isDragging=false, startX=0, startY=0;
  dashboard.addEventListener("mousedown", e=>{
    if(e.target.classList.contains("card")||e.target.closest(".card")) return;
    isDragging=true; startX=e.pageX; startY=e.pageY;
    marquee=document.createElement("div"); marquee.className="selection-rectangle"; document.body.appendChild(marquee);
    marquee.style.left=startX+"px"; marquee.style.top=startY+"px"; marquee.style.width="0px"; marquee.style.height="0px";
  });
  dashboard.addEventListener("mousemove", e=>{
    if(!isDragging) return;
    const x=Math.min(e.pageX,startX), y=Math.min(e.pageY,startY);
    const w=Math.abs(e.pageX-startX), h=Math.abs(e.pageY-startY);
    marquee.style.left=x+"px"; marquee.style.top=y+"px"; marquee.style.width=w+"px"; marquee.style.height=h+"px";

    document.querySelectorAll(".card").forEach(card=>{
      const rect=card.getBoundingClientRect(); const marRect=marquee.getBoundingClientRect();
      if(rect.left<marRect.right && rect.right>marRect.left && rect.top<marRect.bottom && rect.bottom>marRect.top){
        if(!selectedCards.includes(card)) { card.classList.add("selected"); selectedCards.push(card); }
      } else {
        if(selectedCards.includes(card) && !e.ctrlKey && !e.metaKey){ card.classList.remove("selected"); selectedCards=selectedCards.filter(c=>c!==card); }
      }
    });
  updateDownloadBtn();
  });
  document.addEventListener("mouseup", e=>{ if(isDragging){ isDragging=false; if(marquee){ marquee.remove(); marquee=null; } } });
}

loadData();
</script>
</body>
</html>

