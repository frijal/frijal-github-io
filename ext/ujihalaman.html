<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Uji Lengkap Manifest ‚Ä¢ PWA ‚Ä¢ SEO ‚Ä¢ Structured Data</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#0f172a; color:#e5e7eb; padding:20px; }
    h1 { color:#3b82f6; }
    h2 { color:#f97316; margin-top:24px; }
    pre { background:#1e293b; padding:10px; border-radius:8px; overflow-x:auto; }
    .ok { color:#22c55e; }
    .fail { color:#ef4444; }
    section { margin-bottom:30px; }
    .article-report { border:1px solid #334155; border-radius:8px; padding:12px; margin:8px 0; background:#1e293b; }
  </style>
</head>
<body>
  <h1>üîç Uji Lengkap Manifest ‚Ä¢ PWA ‚Ä¢ SEO ‚Ä¢ Structured Data</h1>

  <section>
    <h2>1. Uji Manifest & PWA</h2>
    <div id="statusManifest">Memuat manifest...</div>
    <pre id="jsonManifest"></pre>
    <div id="iconsManifest"></div>
    <div id="statusPWA"></div>
  </section>

  <section>
    <h2>2. Uji Semua Artikel dari <code>artikel.json</code></h2>
    <div id="articlesReport">Memuat daftar artikel...</div>
  </section>

  <script>
    const manifestUrl = "/site.webmanifest"; // manifest di root

    // --- Uji Manifest + PWA ---
    fetch(manifestUrl)
      .then(r => r.json())
      .then(data => {
        document.getElementById("statusManifest").innerHTML = "‚úÖ Manifest berhasil dimuat";
        document.getElementById("jsonManifest").textContent = JSON.stringify(data, null, 2);
        if (data.icons) {
          const iconsDiv = document.getElementById("iconsManifest");
          iconsDiv.innerHTML = "<h3>Ikon:</h3>";
          data.icons.forEach(icon => {
            const img = document.createElement("img");
            img.src = "/" + icon.src; // ikon di ext/icons/
            img.alt = icon.sizes;
            img.title = icon.sizes;
            iconsDiv.appendChild(img);
          });
        }
        document.getElementById("statusPWA").innerHTML = 
          (data.name && data.icons && data.start_url)
          ? "üöÄ PWA installable (name, icons, start_url lengkap)"
          : "‚ö† Masih ada properti PWA yang kurang";
      })
      .catch(err => { document.getElementById("statusManifest").innerHTML = "‚ùå " + err.message; });

    // --- Uji Semua Artikel dari artikel.json ---
    const container = document.getElementById("articlesReport");

    function checkMeta(doc, selector, label) {
      return doc.querySelector(selector)
        ? `<li class="ok">‚úî ${label} ada</li>`
        : `<li class="fail">‚úñ ${label} tidak ada</li>`;
    }

    fetch("/artikel.json")
      .then(r => r.json())
      .then(list => {
        container.innerHTML = "";
        list.forEach(item => {
          const url = "/artikel/" + item.file;
          fetch(url)
            .then(r => r.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const title = doc.querySelector("title")?.innerText || item.title || item.file;

              let report = `<div class="article-report"><h3>üìÑ ${title}</h3><ul>`;
              report += checkMeta(doc,'meta[name="description"]',"Description");
              report += checkMeta(doc,'link[rel="canonical"]',"Canonical");
              report += checkMeta(doc,'meta[property="og:title"]',"OG Title");
              report += checkMeta(doc,'meta[property="og:description"]',"OG Description");
              report += checkMeta(doc,'meta[property="og:image"]',"OG Image");
              report += checkMeta(doc,'meta[name="twitter:card"]',"Twitter Card");
              report += checkMeta(doc,'meta[name="twitter:title"]',"Twitter Title");
              report += checkMeta(doc,'meta[name="twitter:description"]',"Twitter Description");
              report += checkMeta(doc,'meta[name="twitter:image"]',"Twitter Image");
              report += checkMeta(doc,'script[type="application/ld+json"]',"Structured Data");
              report += "</ul></div>";

              container.innerHTML += report;
            })
            .catch(() => {
              container.innerHTML += `<div class="article-report"><h3>üìÑ ${item.file}</h3><p class="fail">‚ùå Tidak bisa dimuat</p></div>`;
            });
        });
      })
      .catch(() => {
        container.innerHTML = "‚ùå Gagal memuat artikel.json";
      });
  </script>
</body>
</html>

