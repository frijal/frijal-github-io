- name: 🔍 Temukan, Periksa, dan Proses File HTML
        id: process_files
        run: |
          CHANGES_MADE=false
          mkdir -p artikel
          
          PLAYWRIGHT_IMAGE="mcr.microsoft.com/playwright:v1.55.1-jammy" 
          
          if [ ! -f "ext/screenshot.js" ]; then
            echo "::error::File 'ext/screenshot.js' tidak ditemukan. Harap tambahkan skrip secara manual."
            exit 1
          fi
          
          find artikel/ -name "*.html" | while read -r HTML_FILE; do
              
              BASE_NAME=$(echo "$HTML_FILE" | sed -e 's|^artikel/||' -e 's|.html$||')
              FILE_NAME=$(echo "$BASE_NAME" | sed 's|[^a-zA-Z0-9_-]|_|g')
              FINAL_PATH="artikel/${FILE_NAME}.jpg"
              TEMP_OUTPUT_OUTSIDE="temp_screenshot.jpg" # Nama file yang dicari di runner
              
              echo "--- Memproses $HTML_FILE -> $FINAL_PATH ---"
              
              if [ -f "$FINAL_PATH" ]; then
                  echo "Screenshot JPG sudah ada: $FINAL_PATH. Dilewati."
              else
                  LOCAL_URL="http://localhost:8080/$(echo "$HTML_FILE" | sed 's|^./||')"
                  
                  echo "Mengambil screenshot..."
                  
                  # !!! PERBAIKAN KRITIS: Output diarahkan ke /workspace/temp_screenshot.jpg !!!
                  # Kita mengandalkan skrip JS di /workspace/ext/screenshot.js
                  docker run --rm \
                    -v "${PWD}:/workspace" \
                    --network host "$PLAYWRIGHT_IMAGE" \
                    bash -c "\
                      # Cek instalasi Playwright di runner utama melalui mount volume
                      if [ ! -d /workspace/node_modules/playwright ]; then \
                          echo '::error::Playwright tidak ditemukan di node_modules runner. Jalankan npm install playwright.'; exit 1; \
                      fi; \
                      \
                      export NODE_PATH=/workspace/node_modules && \
                      node /workspace/ext/screenshot.js '$LOCAL_URL' '/workspace/$TEMP_OUTPUT_OUTSIDE'\
                    "
                  
                  DOCKER_EXIT_CODE=$?
                  
                  # 2. Periksa Hasil Setelah Docker Selesai
                  if [ $DOCKER_EXIT_CODE -eq 0 ] && [ -f "$TEMP_OUTPUT_OUTSIDE" ]; then
                      # Proses berhasil: Pindahkan dan ganti nama (File sekarang ada di root runner)
                      mv "$TEMP_OUTPUT_OUTSIDE" "$FINAL_PATH"
                      echo "[SUCCESS] Screenshot baru berhasil disimpan: $FINAL_PATH"
                      CHANGES_MADE=true
                  else
                      # Proses gagal: File hilang atau Exit Code bukan 0
                      echo "::warning::[FAILED] Gagal memproses $HTML_FILE. Docker Exit Code: $DOCKER_EXIT_CODE. File output $TEMP_OUTPUT_OUTSIDE hilang atau gagal dibuat."
                      rm -f "$TEMP_OUTPUT_OUTSIDE"
                  fi
              fi
          done
          
          if [ "$CHANGES_MADE" = true ]; then
             echo "changes_made=true" >> $GITHUB_OUTPUT
          else
             echo "changes_made=false" >> $GITHUB_OUTPUT
          fi
