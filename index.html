<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daftar Isi Interaktif Modern</title>
<style>
body { font-family: 'Segoe UI', Arial; margin:0; padding-top:60px; background:#f2f2f2; color:#333; }
h1 { text-align:center; margin:20px 0; font-size:2.5rem; font-weight:900; }
#marquee-container { width:100%; background:#007BFF; color:white; overflow:hidden; white-space:nowrap; position:fixed; top:0; left:0; z-index:9999; padding:10px 0; font-size:14px; font-weight:bold; }
#marquee-content { display:inline-block; padding-left:100%; animation:marquee 400s linear infinite; will-change:transform; }
#infoBar { display:flex; flex-wrap: wrap; justify-content:center; align-items:center; gap:20px; font-size:14px; margin-top:50px; }
#toc { max-width:900px; margin:20px auto; }
.category { margin:10px 0; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); background:white; }
.category-header { cursor:pointer; padding:10px 16px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; background:#007BFF; color:white; }
.toc-list { display:none; padding:0 16px; }
.toc-item { display:flex; align-items:center; margin:4px 0; padding:4px 0; border-bottom:1px solid #f0f0f0; }
.toc-title a { flex:1; text-decoration:none; color:#333; font-weight:bold; }
.label-new { background:#28a745; color:white; padding:2px 5px; border-radius:8px; margin-left:6px; }
.label-visited { background:#6c757d; color:white; padding:2px 5px; border-radius:8px; margin-left:6px; }
.label-duplicate { background:#ffc107; color:black; padding:2px 5px; border-radius:8px; margin-left:6px; }
@keyframes marquee { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<div id="marquee-container"><div id="marquee-content">Memuat judul artikel...</div></div>

<div id="infoBar">
  <div><img id="browserIcon" width="24"><span id="browserText">Browser: ...</span></div>
  <div><img id="osIcon" width="24"><span id="osText">OS: ...</span></div>
  <div><img id="flagIcon" width="24"><span id="ipText">IP: ...</span></div>
</div>

<div id="controls" style="text-align:center; margin:15px 0;">
  <input type="text" id="search" placeholder="Cari judul..." style="width:80%; max-width:400px; padding:10px; font-size:16px;">
  <button id="toggleAll" style="margin:5px; padding:6px 12px; border:none; background:#007BFF; color:white; border-radius:4px; cursor:pointer;">Tampilkan/Sembunyikan Semua</button>
</div>

<div id="toc"></div>

<script>
// --- kategori & gradient ---
const gradientMap = {
  "Arch": "linear-gradient(180deg, #007BFF, #00d4ff)",
  "Debian": "linear-gradient(180deg, #28a745, #85e085)",
  "Desktop": "linear-gradient(180deg, #6f42c1, #a56bff)",
  "Kehidupan": "linear-gradient(180deg, #fd7e14, #ffbf47)",
  "Kerja": "linear-gradient(180deg, #17a2b8, #55d6e0)",
  "Kuliner": "linear-gradient(180deg, #dc3545, #ff7f7f)",
  "Multimedia": "linear-gradient(180deg, #6610f2, #a285ff)",
  "NixOS": "linear-gradient(180deg, #20c997, #6fe5c9)",
  "OpenSUSE": "linear-gradient(180deg, #ffc107, #fff14f)",
  "OS Linux": "linear-gradient(180deg, #343a40, #6c757d)",
  "OS Windows": "linear-gradient(180deg, #007BFF, #66b3ff)",
  "Redhat": "linear-gradient(180deg, #d63384, #ff77b5)",
  "Religi": "linear-gradient(180deg, #fd7e14, #ffa64d)",
  "Repository": "linear-gradient(180deg, #6c757d, #a8a9ad)",
  "Slackware": "linear-gradient(180deg, #198754, #56d685)",
  "Lainnya": "linear-gradient(180deg, #adb5bd, #e1e2e3)"
};

// --- load JSON artikel ---
async function loadArticles(){
  const res = await fetch('artikel.json');
  const data = await res.json();
  displayTOC(data);
  updateMarquee(data);
}

// --- tampilkan TOC ---
function displayTOC(DATA){
  const toc = document.getElementById("toc");
  toc.innerHTML = "";
  const grouped = {};
  const visitedLinks = JSON.parse(localStorage.getItem("visitedLinks")||"[]");
  const counts = {};
  const duplicates = new Set();

  DATA.forEach(d=>{
    const t=d.title.toLowerCase();
    counts[t]=(counts[t]||0)+1;
    if(counts[t]>1) duplicates.add(t);
    if(!grouped[d.category]) grouped[d.category]=[];
    grouped[d.category].push(d);
  });

  Object.keys(grouped).sort().forEach(cat=>{
    const section = document.createElement("div");
    section.className="category";
    section.innerHTML=`<div class="category-header">${cat} <span class="badge">${grouped[cat].length}</span></div><div class="toc-list"></div>`;
    const list = section.querySelector(".toc-list");

    const grad = gradientMap[cat] || gradientMap["Lainnya"];
    section.querySelector(".category-header").style.background = grad;

    grouped[cat].forEach((item,i)=>{
      const clean=item.title.toLowerCase();
      const el=document.createElement("div");
      el.className="toc-item"; el.dataset.text=clean;

      const a=document.createElement("a"); a.href=item.url; a.target="_blank"; a.textContent=`${i+1}. ${item.title}`;
      if(visitedLinks.includes(item.url)) a.classList.add("visited");

      a.addEventListener("click", ()=>{
        if(!visitedLinks.includes(item.url)){
          visitedLinks.push(item.url);
          localStorage.setItem("visitedLinks", JSON.stringify(visitedLinks));
        }
        a.classList.add("visited");
      });

      const status = document.createElement("span");
      status.className = visitedLinks.includes(item.url) ? "label-visited" : "label-new";
      status.textContent = visitedLinks.includes(item.url) ? "sudah dibaca 👍" : "📚 belum di klik";

      const dup = duplicates.has(clean) ? (()=>{const s=document.createElement("span"); s.className="label-duplicate"; s.textContent="⚠️ Duplikat"; return s;})() : null;

      const div = document.createElement("div"); div.className="toc-title"; div.append(a,status); if(dup) div.appendChild(dup);
      el.appendChild(div); list.appendChild(el);
    });

    section.querySelector(".category-header").addEventListener("click", ()=>{list.style.display = list.style.display==="block"?"none":"block";});
    toc.appendChild(section);
  });

  document.getElementById("search").addEventListener("input",function(){
    const term=this.value.toLowerCase();
    document.querySelectorAll(".toc-item").forEach(item=>{ item.style.display=item.dataset.text.includes(term)?"flex":"none"; });
  });

  document.getElementById("toggleAll").addEventListener("click",()=>{
    const lists=document.querySelectorAll(".toc-list");
    const exp=[...lists].some(l=>l.style.display==="none"||l.style.display==="");
    lists.forEach(l=>l.style.display=exp?"block":"none");
  });
}

// --- marquee ---
function updateMarquee(DATA){
  const m=document.getElementById("marquee-content");
  const shuffled=DATA.slice();
  for(let i=shuffled.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]];}
  m.innerHTML = shuffled.map(d=>`<a href="${d.url}" target="_blank">${d.title}</a>`).join(" • ");
}

// --- OS, Browser, IP ---
function getBrowserInfo(){const ua=navigator.userAgent;let name="Unknown", icon="", version="N/A"; if(ua.indexOf("Firefox")>-1){name="Firefox";version=ua.match(/Firefox\/([0-9\.]+)/)[1];icon="https://upload.wikimedia.org/wikipedia/commons/a/a0/Firefox_logo%2C_2019.svg";} else if(ua.indexOf("Chrome")>-1){name="Chrome";version=ua.match(/Chrome\/([0-9\.]+)/)[1];icon="https://upload.wikimedia.org/wikipedia/commons/8/87/Google_Chrome_icon_%282011%29.png";} return {name,version,icon};}
function getOSInfo(){const p=navigator.platform.toLowerCase();let name="Unknown OS",icon=""; if(p.indexOf("win")!==-1) name="Windows",icon="https://upload.wikimedia.org/wikipedia/commons/5/5f/Windows_logo_-_2021.svg"; else if(p.indexOf("mac")!==-1) name="macOS",icon="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg"; else if(p.indexOf("linux")!==-1) name="Linux",icon="https://upload.wikimedia.org/wikipedia/commons/a/af/Tux.png"; return {name,icon};}
const b = getBrowserInfo(); const o = getOSInfo();
document.getElementById('browserIcon').src = b.icon; document.getElementById('browserText').textContent = `${b.name} ${b.version}`;
document.getElementById('osIcon').src = o.icon; document.getElementById('osText').textContent = o.name;
fetch('https://ipapi.co/json/').then(r=>r.json()).then(d=>{document.getElementById('ipText').textContent=`${d.ip} (${d.city})`; document.getElementById('flagIcon').src=`https://flagcdn.com/48x36/${d.country_code.toLowerCase()}.png`;});

loadArticles(); // panggil JSON
</script>
</body>
</html>
