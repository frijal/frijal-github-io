<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daftar Isi Otomatis</title>
<style>
  body{font-family:Arial;margin:0;padding-top:120px;background:#f2f2f2;color:#333;}
  h1{text-align:center;margin:20px;font-size:2rem;}
  #marquee-container{width:100%;background:#007BFF;color:white;overflow:hidden;position:fixed;top:0;left:0;z-index:9999;padding:10px 0;font-size:14px;font-weight:bold;}
  #marquee-content{display:inline-block;padding-left:100%;animation:marquee 400s linear infinite;}
  #infoBar{text-align:center;margin-top:5px;font-size:14px;}
  #toc{max-width:900px;margin:20px auto;}
  .category{margin:10px 0;background:white;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  .category-header{padding:10px 16px;font-weight:bold;cursor:pointer;background:#007BFF;color:white;display:flex;justify-content:space-between;align-items:center;}
  .toc-list{display:none;padding:0 16px;}
  .toc-item{margin:5px 0;}
  .toc-item a{text-decoration:none;color:#333;}
  .toc-item a.visited{color:gray;}
  .label-new{background:#28a745;color:white;padding:2px 5px;border-radius:8px;margin-left:6px;}
  .label-visited{background:#6c757d;color:white;padding:2px 5px;border-radius:8px;margin-left:6px;}
  .label-duplicate{background:#ffc107;color:black;padding:2px 5px;border-radius:8px;margin-left:6px;}
  @keyframes marquee{0%{transform:translateX(0%);}100%{transform:translateX(-100%);}}
</style>
</head>
<body>
<div id="marquee-container"><div id="marquee-content">Memuat judul artikel...</div></div>
<div id="infoBar">Memuat info browser & IP...</div>
<div id="toc"></div>

<script>
const gradientMap = {
  "Arch": "linear-gradient(180deg, #007BFF, #00d4ff)",
  "Debian": "linear-gradient(180deg, #28a745, #85e085)",
  "Desktop": "linear-gradient(180deg, #6f42c1, #a56bff)",
  "Kehidupan": "linear-gradient(180deg, #fd7e14, #ffbf47)",
  "Kerja": "linear-gradient(180deg, #17a2b8, #55d6e0)",
  "Kuliner": "linear-gradient(180deg, #dc3545, #ff7f7f)",
  "Multimedia": "linear-gradient(180deg, #6610f2, #a285ff)",
  "NixOS": "linear-gradient(180deg, #20c997, #6fe5c9)",
  "OpenSUSE": "linear-gradient(180deg, #ffc107, #fff14f)",
  "OS Linux": "linear-gradient(180deg, #343a40, #6c757d)",
  "OS Windows": "linear-gradient(180deg, #007BFF, #66b3ff)",
  "Redhat": "linear-gradient(180deg, #d63384, #ff77b5)",
  "Religi": "linear-gradient(180deg, #fd7e14, #ffa64d)",
  "Repository": "linear-gradient(180deg, #6c757d, #a8a9ad)",
  "Slackware": "linear-gradient(180deg, #198754, #56d685)",
  "Lainnya": "linear-gradient(180deg, #adb5bd, #e1e2e3)"
};

function titleToCategory(title){
  const t=title.toLowerCase();
  const cats=[
   {name:"Arch",k:["manjaro","cachy","arch"]},
    {name:"Debian",k:["debian","ubuntu","mint","mx","elementary","puppy","kali","kubuntu","xubuntu"]},
    {name:"Desktop",k:["kde","hyperland","caja","ukui","pantheon","deepin","lxde","budgie","mate","gnome","cinnamon","xfce"]},
    {name:"Kehidupan",k:["hidup","uang","dosa","alasan","kehidupan","tidur","sahabat","teman","sombong","wanita","pria","perempuan","laki","silaturahim","daily"]},
    {name:"Kerja",k:["kerja","kantor","dokumen","strategi","pdf","psikotes","karir"]},
    {name:"Kuliner",k:["resep","makan","minum","bumbu","kuliner"]},
    {name:"Multimedia",k:["video","foto","audio","film","ffmpeg","imagemagick"]},
    {name:"NixOS",k:["nixos"]},
    {name:"OpenSUSE",k:["opensuse"]},
    {name:"OS Linux",k:["grub","autoremove","cron","reinstall","dd","troubleshooting","skrip","rsync","system","sudo","backup","plugin","ssh","symlinks","mount","samba","linux","bootloader","distro","release","rilis"]},
    {name:"OS Windows",k:["windows"]},
    {name:"Redhat",k:["fedora","centos"]},
    {name:"Religi",k:["allah","shalat","sholat","agama","puasa","nabi","islam","madinah","religi"]},
    {name:"Repository",k:["repository","dnf","apt","repo","snap","synaptic","octopi","flatpak","netselect","mirror","reflector"]},
    {name:"Slackware",k:["slackware"]}
  ];
  return (cats.find(c=>c.k.some(k=>t.includes(k)))||{name:"Lainnya"}).name;
}

// fetch index.json
async function fetchArticles(){
  const res = await fetch('artikel/index.json');
  const files = await res.json();
  const DATA=[];
  for(const f of files){
    try{
      const t = await (await fetch('artikel/'+f)).text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(t,'text/html');
      const title = doc.querySelector('title')?.innerText||f;
      DATA.push({title,url:'artikel/'+f,category:titleToCategory(title)});
    }catch(e){
      DATA.push({title:f,url:'artikel/'+f,category:"Lainnya"});
    }
  }
  displayTOC(DATA);
  updateMarquee(DATA);
}

function displayTOC(DATA){
  const toc=document.getElementById('toc'); toc.innerHTML='';
  const grouped={};
  const visited=JSON.parse(localStorage.getItem('visitedLinks')||'[]');
  const duplicates=new Set();
  const counts={};
  DATA.forEach(d=>{
    const t=d.title.toLowerCase();
    counts[t]=(counts[t]||0)+1;
    if(counts[t]>1) duplicates.add(t);
    if(!grouped[d.category]) grouped[d.category]=[];
    grouped[d.category].push(d);
  });

  for(const cat of Object.keys(grouped).sort()){
    const section=document.createElement('div'); section.className='category';
    section.innerHTML=`<div class="category-header">${cat} (${grouped[cat].length})</div><div class="toc-list"></div>`;
    const list=section.querySelector('.toc-list');

    grouped[cat].forEach((item,i)=>{
      const div=document.createElement('div'); div.className='toc-item';
      const a=document.createElement('a'); a.href=item.url; a.target='_blank'; a.textContent=`${i+1}. ${item.title}`;
      if(visited.includes(item.url)) a.classList.add('visited');
      a.addEventListener('click',()=>{
        if(!visited.includes(item.url)){
          visited.push(item.url); localStorage.setItem('visitedLinks',JSON.stringify(visited));
          a.classList.add('visited');
        }
      });
      const span=document.createElement('span'); span.className=visited.includes(item.url)?'label-visited':'label-new';
      span.textContent=visited.includes(item.url)?'sudah dibaca 👍':'📚 belum dibaca';
      div.appendChild(a); div.appendChild(span);

      if(duplicates.has(item.title.toLowerCase())){
        const dup=document.createElement('span'); dup.className='label-duplicate'; dup.textContent='⚠️ Duplikat';
        div.appendChild(dup);
      }

      list.appendChild(div);
    });

    section.querySelector('.category-header').addEventListener('click',()=>{list.style.display=list.style.display==='block'?'none':'block';});
    toc.appendChild(section);
  }
}

function updateMarquee(DATA){
  const m=document.getElementById('marquee-content');
  const shuffled=DATA.slice().sort(()=>0.5-Math.random());
  m.innerHTML=shuffled.map(d=>`<a href="${d.url}" target="_blank">${d.title}</a>`).join(' • ');
}

// info OS, browser, IP
const os = navigator.platform; const browser=navigator.userAgent;
document.getElementById('infoBar').textContent=`Browser: ${browser} | OS: ${os}`;
fetch('https://ipapi.co/json/').then(r=>r.json()).then(d=>{
  document.getElementById('infoBar').textContent+=` | IP: ${d.ip} (${d.city})`;
}).catch(()=>{document.getElementById('infoBar').textContent+=' | IP: Tidak bisa diambil';});

fetchArticles();
</script>
</body>
</html>
