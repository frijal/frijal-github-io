<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daftar Isi Interaktif</title>
<style>
body { font-family: 'Segoe UI', Arial; margin:0; padding-top:70px; background:#f2f2f2; color:#333; }
h1 { text-align:center; margin-bottom:20px; font-size:2rem; }

/* Marquee */
#marquee-container { width:100%; background:#007BFF; color:white; overflow:hidden; white-space:nowrap; position:fixed; top:0; left:0; z-index:9999; padding:10px 0; font-size:14px; font-weight:bold; }
#marquee-content { display:inline-block; padding-left:100%; animation:marquee 200s linear infinite; will-change:transform; }
#marquee-container:hover #marquee-content { animation-play-state:paused; }
#marquee-content a { color:white; text-decoration:none; margin-right:30px; transition: color 0.3s; }
#marquee-content a:hover { color:yellow; text-decoration:underline; }
@keyframes marquee { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

/* Info Bar */
#infoBar { display:flex; flex-wrap: wrap; justify-content:center; align-items:center; gap:20px; font-size:14px; text-align:center; margin:10px auto; max-width:900px; }
#infoBar div { display:flex; align-items:center; gap:6px; }
#infoBar svg { width:24px; height:24px; vertical-align:middle; }

/* Search */
#search { width:80%; max-width:400px; padding:10px; font-size:16px; margin:15px auto; display:block; border-radius:6px; border:1px solid #ccc; }

/* Expand/Collapse Button */
#tocToggle { display:block; width:200px; margin:10px auto; padding:8px 12px; font-size:14px; font-weight:bold; border:none; border-radius:6px; cursor:pointer; background:#007BFF; color:white; }

/* TOC */
#toc { max-width:900px; margin:10px auto; }
#totalCount { text-align:center; margin-top:20px; font-weight:bold; font-size:16px; padding:10px; background:#007BFF; color:white; border-radius:6px; }

.category { margin:10px 0; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); background:white; }
.category-header { cursor:pointer; padding:10px 16px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; transition:all 0.3s ease; color:white; position:relative; border-radius:8px; }

/* Animasi hover title */
.category-header::before {
  content:'';
  position:absolute;
  top:0; left:0; right:0; bottom:0;
  border-radius:8px;
  box-shadow:0 0 0 rgba(255,255,255,0);
  transition: box-shadow 0.3s ease, transform 0.3s ease;
}
.category-header:hover::before { box-shadow: 0 4px 15px rgba(255,255,255,0.3); transform: scale(1.02); }
.category-header:hover { transform: translateY(-2px); }

.toc-list { display:none; padding:0 16px; } /* collapse default */
.toc-item { display:flex; align-items:center; margin:4px 0; padding:4px 0; border-bottom:1px solid #f0f0f0; }
.toc-title { flex:1; display:flex; align-items:center; justify-content:flex-start; gap:8px; flex-wrap: wrap; }
.toc-title a { text-decoration:none; color:#333; transition:all 0.3s; font-weight:bold; position:relative; }
.toc-title a.visited { color: gray; }
.toc-title a::after { content:""; position:absolute; left:50%; bottom:-2px; transform:translateX(-50%); width:0; height:2px; background:#fff; transition:width 0.3s ease; }
.toc-title a:hover::after { width:100%; }
.label-new { background:#28a745; color:white; padding:2px 5px; border-radius:8px; }
.label-visited { background:#6c757d; color:white; padding:2px 5px; border-radius:8px; }
.badge { padding:2px 8px; border-radius:12px; font-size:12px; color:white; margin-left:8px; font-weight:bold; }

/* Highlight fade-in */
.highlight { background: yellow; color: black; animation:fadeIn 0.5s ease-in; }
@keyframes fadeIn { from { background: transparent; } to { background: yellow; } }

@media(max-width:500px){ #infoBar { flex-direction:column; gap:10px; } }
</style>
</head>
<body>

<!-- Marquee -->
<div id="marquee-container"><div id="marquee-content">Memuat judul artikel...</div></div>

<!-- Info Bar dengan SVG -->
<div id="infoBar">
  <div>
    <svg id="browserIcon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#888"/></svg>
    <span id="browserText"></span>
  </div>
  <div>
    <svg id="osIcon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" fill="#888"/></svg>
    <span id="osText"></span>
  </div>
  <div>
    <svg id="flagIcon" viewBox="0 0 24 24"><rect width="24" height="16" fill="#888"/></svg>
    <span id="ipText"></span>
  </div>
</div>

<!-- Search -->
<input type="text" id="search" placeholder="Cari judul...">

<!-- Expand/Collapse TOC -->
<button id="tocToggle">Expand TOC</button>

<!-- TOC -->
<div id="toc"></div>
<div id="totalCount">Total artikel: 0</div>

<script>
// Gradient kategori
const gradientMap = {
  "Arch": "linear-gradient(180deg, #1793D1, #51A4C9)",
  "Debian": "linear-gradient(180deg, #A80030, #D23759)",
  "Desktop": "linear-gradient(180deg, #4A2E78, #6B4E9A)",
  "Kehidupan": "linear-gradient(180deg, #F9D030, #FFEA8D)",
  "Kerja": "linear-gradient(180deg, #2B3D4F, #576F86)",
  "Kuliner": "linear-gradient(180deg, #D44E4E, #E58484)",
  "Multimedia": "linear-gradient(180deg, #9C4D9A, #C972C7)",
  "NixOS": "linear-gradient(180deg, #5277C3, #7D9FDE)",
  "OpenSUSE": "linear-gradient(180deg, #74A82F, #9AC16B)",
  "OS Linux": "linear-gradient(180deg, #333333, #666666)",
  "OS Windows": "linear-gradient(180deg, #0078D7, #459DEB)",
  "Redhat": "linear-gradient(180deg, #EE0000, #F84949)",
  "Religi": "linear-gradient(180deg, #6A0DAD, #9D4EDD)",
  "Repository": "linear-gradient(180deg, #8B949E, #B2BDC9)",
  "Slackware": "linear-gradient(180deg, #4B859D, #7AB1C8)",
  "Jaringan": "linear-gradient(180deg, #FF6600, #FF9933)",
  "Pemrograman": "linear-gradient(180deg, #3D886D, #67AE91)",
  "Perangkat Keras": "linear-gradient(180deg, #375A7F, #6A86A8)",
  "Keuangan": "linear-gradient(180deg, #1B5E20, #4CAF50)",
  "Lainnya": "linear-gradient(180deg, #B0BEC5, #CFD8DC)"
};

const visitedLinks = JSON.parse(localStorage.getItem("visitedLinks")||"[]");
let tocCollapsed = true;

async function loadTOC() {
  try {
    const res = await fetch("artikel.json");
    const data = await res.json();
    const toc = document.getElementById("toc");
    toc.innerHTML = "";
    const totalCount = document.getElementById("totalCount");
    totalCount.textContent = `Total artikel: ${data.length}`;

    // Kelompokkan per kategori
    const grouped = {};
    data.forEach(d => { if(!grouped[d.category]) grouped[d.category]=[]; grouped[d.category].push(d); });

    Object.keys(grouped).sort().forEach(cat => {
      const catDiv=document.createElement("div");
      catDiv.className="category";
      catDiv.innerHTML = `<div class="category-header">${cat}</div><div class="toc-list"></div>`;
      const catList = catDiv.querySelector(".toc-list");
      catDiv.querySelector(".category-header").style.background = gradientMap[cat] || gradientMap["Lainnya"];

      grouped[cat].forEach((item,i)=>{
        const el=document.createElement("div"); el.className="toc-item"; el.dataset.text=item.title.toLowerCase();
        const a=document.createElement("a"); a.href=`artikel/${item.file}`; a.target="_blank"; a.textContent=`${i+1}. ${item.title}`;
        const statusSpan=document.createElement("span");
        if(visitedLinks.includes(item.file)){ statusSpan.className="label-visited"; statusSpan.textContent="sudah dibaca 👍"; a.classList.add("visited"); }
        else{ statusSpan.className="label-new"; statusSpan.textContent="📚 belum dibaca"; }
        a.addEventListener("click",()=>{
          if(!visitedLinks.includes(item.file)){
            visitedLinks.push(item.file);
            localStorage.setItem("visitedLinks", JSON.stringify(visitedLinks));
            statusSpan.className="label-visited";
            statusSpan.textContent="sudah dibaca 👍";
            a.classList.add("visited");
          }
        });
        const titleDiv=document.createElement("div");
        titleDiv.className="toc-title"; titleDiv.appendChild(a); titleDiv.appendChild(statusSpan);
        el.appendChild(titleDiv); catList.appendChild(el);
      });

      // Toggle kategori per header
      catDiv.querySelector(".category-header").addEventListener("click",()=>{
        const list = catDiv.querySelector(".toc-list");
        list.style.display = list.style.display==="block" ? "none" : "block";
      });

      toc.appendChild(catDiv);
    });

    // Marquee
    const m = document.getElementById("marquee-content");
    m.innerHTML = data.map(d=>`<a href="artikel/${d.file}" target="_blank">${d.title}</a>`).join(" • ");

    // Search + highlight (tidak auto-expand)
    document.getElementById("search").addEventListener("input", function() {
      const term = this.value.toLowerCase();
      let countVisible = 0;
      document.querySelectorAll(".category").forEach(category=>{
        category.querySelectorAll(".toc-item").forEach(item=>{
          const text=item.dataset.text; const link=item.querySelector("a");
          if(term && text.includes(term)){
            item.style.display="flex"; countVisible++;
            const regex=new RegExp(`(${term})`,"gi");
            link.innerHTML = link.textContent.replace(regex,'<span class="highlight">$1</span>');
          } else{
            item.style.display=term?"none":"flex"; link.innerHTML=link.textContent;
            if(!term) countVisible++;
          }
        });
      });
      totalCount.textContent=`Total artikel: ${countVisible}`;
    });

    // Tombol Expand/Collapse TOC
    document.getElementById("tocToggle").addEventListener("click",()=>{
      tocCollapsed = !tocCollapsed;
      document.querySelectorAll(".toc-list").forEach(list=>{
        list.style.display = tocCollapsed ? "block" : "none";
      });
      document.getElementById("tocToggle").textContent = tocCollapsed ? "Collapse TOC" : "Expand TOC";
    });

  } catch(e){ console.error("Gagal load artikel.json:", e); }
}

loadTOC();

// --- Info Browser, OS, IP dengan SVG ---
function getBrowserInfo(){
  const ua=navigator.userAgent; let name="Unknown", icon="", version="N/A";
  if(/Firefox\/([0-9\.]+)/.test(ua)){ name="Firefox"; version=ua.match(/Firefox\/([0-9\.]+)/)[1]; icon=`<svg viewBox="0 0 24 24" fill="#FF9400"><circle cx="12" cy="12" r="10"/></svg>`; }
  else if(/Edg\/([0-9\.]+)/.test(ua)){ name="Edge"; version=ua.match(/Edg\/([0-9\.]+)/)[1]; icon=`<svg viewBox="0 0 24 24" fill="#0078D7"><circle cx="12" cy="12" r="10"/></svg>`; }
  else if(/Chrome\/([0-9\.]+)/.test(ua)){ name="Chrome"; version=ua.match(/Chrome\/([0-9\.]+)/)[1]; icon=`<svg viewBox="0 0 24 24" fill="#4285F4"><circle cx="12" cy="12" r="10"/></svg>`; }
  else if(/Safari\/([0-9\.]+)/.test(ua) && !/Chrome/.test(ua)){ name="Safari"; version=ua.match(/Version\/([0-9\.]+)/)[1]; icon=`<svg viewBox="0 0 24 24" fill="#00A1F1"><circle cx="12" cy="12" r="10"/></svg>`; }
  return {name,version,icon};
}
function getOSInfo(){
  const platform=navigator.platform.toLowerCase(); let name="Unknown OS", icon="";
  if(platform.includes("win")){ name="Windows"; icon=`<svg viewBox="0 0 24 24" fill="#0078D7"><rect x="2" y="2" width="20" height="20"/></svg>`; }
  else if(platform.includes("mac")){ name="macOS"; icon=`<svg viewBox="0 0 24 24" fill="#000000"><rect x="2" y="2" width="20" height="20"/></svg>`; }
  else if(platform.includes("linux")){ name="Linux"; icon=`<svg viewBox="0 0 24 24" fill="#FCC624"><circle cx="12" cy="12" r="10"/></svg>`; }
  return {name,icon};
}

const browser=getBrowserInfo();
document.getElementById('browserIcon').outerHTML=browser.icon+'<span id="browserText">'+browser.name+' '+browser.version+'</span>';
const os=getOSInfo();
document.getElementById('osIcon').outerHTML=os.icon+'<span id="osText">'+os.name+'</span>';

// IP & flag
fetch('https://ipapi.co/json/')
.then(res=>res.json())
.then(data=>{
  document.getElementById('ipText').textContent=`${data.ip} (${data.city})`;
  const svgFlag = `<svg viewBox="0 0 24 16"><rect width="24" height="16" fill="#${data.country_code.toLowerCase()}"/></svg>`;
  document.getElementById('flagIcon').outerHTML=svgFlag+'<span id="ipText">'+data.ip+' ('+data.city+')</span>';
})
.catch(()=>{ document.getElementById('ipText').textContent='IP: Tidak dapat diambil'; });
</script>
</body>
</html>
