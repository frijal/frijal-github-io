<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daftar Isi Lazy Load + JSON</title>
<style>
body { font-family:'Segoe UI', Arial; margin:0; padding-top:100px; background:#f2f2f2; color:#333; }
#marquee-container { width:100%; background:#007BFF; color:white; overflow:hidden; white-space:nowrap; position:fixed; top:0; left:0; z-index:9999; padding:10px 0; font-size:14px; font-weight:bold; }
#marquee-content { display:inline-block; padding-left:100%; animation:marquee 200s linear infinite; will-change:transform; }
#marquee-container:hover #marquee-content { animation-play-state:paused; }
#marquee-content a { color:white; text-decoration:none; margin-right:30px; }
#controls { text-align:center; margin:15px 0; }
#search { width:80%; max-width:400px; padding:10px; font-size:16px; border-radius:6px; border:1px solid #ccc; }
#toggleAll { margin:5px; padding:6px 12px; border:none; background:#007BFF; color:white; border-radius:4px; cursor:pointer; }
.category { margin:10px auto; max-width:900px; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); background:white; }
.category-header { cursor:pointer; padding:10px 16px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; font-size:1.3rem; color:white; }
.toc-list { display:none; padding:0 16px; }
.toc-item { display:flex; align-items:center; margin:4px 0; padding:4px 0; border-bottom:1px solid #f0f0f0; position:relative; }
.toc-title { flex:1; display:flex; align-items:center; justify-content:flex-start; gap:8px; flex-wrap: wrap; }
.toc-title a { text-decoration:none; color:#333; font-weight:bold; }
.label-new { background:#28a745; color:white; padding:2px 5px; border-radius:8px; }
.label-visited { background:#6c757d; color:white; padding:2px 5px; border-radius:8px; }
.label-duplicate { background:#ffc107; color:black; padding:2px 5px; border-radius:8px; }
.badge { padding:2px 8px; border-radius:12px; font-size:12px; color:white; font-weight:bold; }
</style>
</head>
<body>

<div id="marquee-container"><div id="marquee-content">Memuat judul artikel...</div></div>

<h1 style="text-align:center;">Daftar Isi Lazy Load + JSON</h1>

<div id="controls">
  <input type="text" id="search" placeholder="Cari judul...">
  <button id="toggleAll">Tampilkan/Sembunyikan Semua</button>
</div>

<div id="toc"></div>

<script>
const BATCH_SIZE=20;
let DATA=[], loadedIndex=0;

// Gradient kategori
const gradientMap = {
  "Arch": "linear-gradient(180deg, #1793D1, #51A4C9)",
  "Debian": "linear-gradient(180deg, #A80030, #D23759)",
  "Desktop": "linear-gradient(180deg, #4A2E78, #6B4E9A)",
  "Kehidupan": "linear-gradient(180deg, #F9D030, #FFEA8D)",
  "Kerja": "linear-gradient(180deg, #2B3D4F, #576F86)",
  "Kuliner": "linear-gradient(180deg, #D44E4E, #E58484)",
  "Multimedia": "linear-gradient(180deg, #9C4D9A, #C972C7)",
  "NixOS": "linear-gradient(180deg, #5277C3, #7D9FDE)",
  "OpenSUSE": "linear-gradient(180deg, #74A82F, #9AC16B)",
  "OS Linux": "linear-gradient(180deg, #333333, #666666)",
  "OS Windows": "linear-gradient(180deg, #0078D7, #459DEB)",
  "Redhat": "linear-gradient(180deg, #EE0000, #F84949)",
  "Religi": "linear-gradient(180deg, #6A0DAD, #9D4EDD)",
  "Repository": "linear-gradient(180deg, #8B949E, #B2BDC9)",
  "Slackware": "linear-gradient(180deg, #4B859D, #7AB1C8)",
  "Jaringan": "linear-gradient(180deg, #FF6600, #FF9933)",
  "Pemrograman": "linear-gradient(180deg, #3D886D, #67AE91)",
  "Perangkat Keras": "linear-gradient(180deg, #375A7F, #6A86A8)",
  "Keuangan": "linear-gradient(180deg, #1B5E20, #4CAF50)",
  "Lainnya": "linear-gradient(180deg, #B0BEC5, #CFD8DC)"
};

// Fetch artikel.json
async function loadData(){
  try{
    const res = await fetch('artikel.json');
    DATA = await res.json();
    DATA.sort((a,b)=>a.title.localeCompare(b.title));
    renderBatch();
    updateMarquee();
  }catch(e){
    console.error("Gagal load artikel.json", e);
  }
}

// Render batch
function renderBatch(){
  if(loadedIndex>=DATA.length) return;
  const batch = DATA.slice(loadedIndex, loadedIndex+BATCH_SIZE);
  const toc=document.getElementById("toc");
  const grouped={}; const visitedLinks=JSON.parse(localStorage.getItem("visitedLinks")||"[]"); const counts={}; const duplicates=new Set();
  batch.forEach(d=>{ const t=d.title.toLowerCase(); counts[t]=(counts[t]||0)+1; if(counts[t]>1) duplicates.add(t); if(!grouped[d.category]) grouped[d.category]=[]; grouped[d.category].push(d); });
  Object.keys(grouped).sort().forEach(cat=>{
    let section=document.querySelector(`.category[data-cat="${cat}"]`);
    if(!section){
      section=document.createElement("div"); section.className="category"; section.dataset.cat=cat;
      section.innerHTML=`<div class="category-header">${cat} <span class="badge">${grouped[cat].length}</span></div><div class="toc-list"></div>`;
      const grad=gradientMap[cat]||gradientMap["Lainnya"];
      section.querySelector(".category-header").style.background=grad;
      section.querySelector(".badge").style.background=grad;
      section.querySelector(".category-header").addEventListener("click",()=>{ const l=section.querySelector(".toc-list"); l.style.display=l.style.display==="block"?"none":"block"; });
      toc.appendChild(section);
    } else {
      const badge=section.querySelector(".badge"); badge.textContent=parseInt(badge.textContent)+grouped[cat].length;
    }
    const list=section.querySelector(".toc-list");
    grouped[cat].forEach((item,i)=>{
      const clean=item.title.toLowerCase();
      const el=document.createElement("div"); el.className="toc-item"; el.dataset.text=clean;
      const a=document.createElement("a"); a.href=item.file; a.target="_blank"; a.textContent=item.title;
      if(visitedLinks.includes(item.file)) a.classList.add("visited");
      a.addEventListener("click",()=>{ if(!visitedLinks.includes(item.file)){ visitedLinks.push(item.file); localStorage.setItem("visitedLinks",JSON.stringify(visitedLinks)); a.classList.add("visited"); } });
      const titleDiv=document.createElement("div"); titleDiv.className="toc-title"; titleDiv.appendChild(a);
      const statusSpan=document.createElement("span"); statusSpan.className=visitedLinks.includes(item.file)?"label-visited":"label-new"; statusSpan.textContent=visitedLinks.includes(item.file)?"sudah dibaca 👍":"📚 belum di klik"; titleDiv.appendChild(statusSpan);
      if(duplicates.has(clean)){ const dup=document.createElement("span"); dup.className="label-duplicate"; dup.textContent="⚠️ Duplikat Judul"; titleDiv.appendChild(dup); }
      el.appendChild(titleDiv); list.appendChild(el);
    });
  });
  loadedIndex+=BATCH_SIZE;
}

// Update marquee
function updateMarquee(){
  const marquee=document.getElementById("marquee-content");
  marquee.innerHTML=DATA.map(d=>`<a href="${d.file}" target="_blank">${d.title}</a>`).join(" • ");
}

// Infinite scroll
window.addEventListener("scroll",()=>{ if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 100){ renderBatch(); } });

document.getElementById("toggleAll").addEventListener("click",()=>{ const lists=document.querySelectorAll(".toc-list"); const exp=[...lists].some(l=>l.style.display==="none"||l.style.display===""); lists.forEach(l=>l.style.display=exp?"block":"none"); });

document.getElementById("search").addEventListener("input",function(){ const term=this.value.toLowerCase(); document.querySelectorAll(".toc-item").forEach(item=>{ item.style.display=item.dataset.text.includes(term)?"flex":"none"; }); });

loadData();
</script>
</body>
</html>
