<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jelajahi Artikel: Windows, Linux (Ubuntu, Arch, Fedora), Religi, & Karir | Frijal</title>
  <style>
    /* ... (CSS Anda sebelumnya dipertahankan) ... */
    /* Tambahan kecil untuk styling tanggal */
    .article-card .card-content p.article-date {
        font-size: 0.8em;
        color: var(--text-muted);
        margin-top: 5px;
        margin-bottom: 0;
    }
  </style>
</head>
<body id="top">
  <div class="container">
    <h1>Galeri Artikel</h1>
    <div id="main-container"></div>
  </div>
  <footer class="page-footer">
    <div id="footerInfo"></div>
  </footer>
  <nav id="quick-nav" aria-label="Navigasi cepat"></nav>
  <script>
    // Konstanta untuk Indeks Data pada array artikel
    const IDX_TITLE = 0;
    const IDX_FILENAME = 1;
    const IDX_IMAGE = 2;
    const IDX_DATE = 3;
    const IDX_DESCRIPTION = 4;
    const DEFAULT_THUMBNAIL = '/thumbnail.jpg';

    const CATEGORY_ICON_MAP = [
      { key: "Linux & Open Source", icon: "ðŸ§", cls: "linux" },
      { key: "Islam & Kehidupan", icon: "ðŸ“š", cls: "religi" },
      { key: "Lainnya", icon: "ðŸ—‚ï¸", cls: "lainnya" },
      { key: "Multimedia & Editing", icon: "ðŸ“½ï¸", cls: "multimedia" },
      { key: "Catatan & Sosial", icon: "ðŸ“°", cls: "catatan" },
      { key: "Budaya, Kuliner & Lifestyle", icon: "ðŸžï¸", cls: "budaya" },
      { key: "Windows & Teknologi Umum", icon: "ðŸ’»", cls: "windows" }
    ];

    // Fungsi utilitas dipertahankan
    function getIconAndClass(categoryName) {
      const found = CATEGORY_ICON_MAP.find(m => categoryName.includes(m.key));
      return found ?? { icon: "ðŸ“‚", cls: "default" };
    }
    
    function categoryToId(categoryName) {
        return categoryName
            .toLowerCase()
            .replace(/\s+/g, '-')
            .replace(/[^a-z0-9-]/g, '');
    }
    
    function formatDate(dateString) {
        // Mengubah format ISO Date string menjadi DD MMMM YYYY (misalnya: 25 Mei 2025)
        try {
            const date = new Date(dateString);
            if (isNaN(date)) return dateString; // Kembali ke string asli jika invalid
            
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        } catch (e) {
            return dateString;
        }
    }

    /**
     * Membuat dan mengembalikan elemen card artikel.
     * @param {Array} item - Data artikel [title, fileName, jsonImage, date, description]
     * @returns {HTMLElement} Elemen tautan 'article-card'.
     */
    function createArticleCard(item) {
        const title = item[IDX_TITLE];
        const fileName = item[IDX_FILENAME];
        const jsonImage = item[IDX_IMAGE] ?? "";
        const dateString = formatDate(item[IDX_DATE]) ?? 'Tanggal tidak diketahui'; // Format tanggal
        const description = item[IDX_DESCRIPTION] ?? title;
        const articleUrl = `artikel/${fileName}`;
        
        let thumbnailUrl = jsonImage;
        if (!thumbnailUrl || !/\.(jpe?g|png|gif|webp|avif|svg)$/i.test(thumbnailUrl)) {
            thumbnailUrl = DEFAULT_THUMBNAIL;
        }
        if (!/^https?:\/\//i.test(thumbnailUrl)) {
            thumbnailUrl = `artikel/${thumbnailUrl}`;
        }

        const link = document.createElement('a');
        link.href = articleUrl;
        link.classList.add('article-card');
        link.title = description;

        const image = document.createElement('img');
        image.src = thumbnailUrl;
        image.alt = `Gambar artikel: ${title}`;
        image.loading = 'lazy';

        const content = document.createElement('div');
        content.classList.add('card-content');
        // Tampilkan Tanggal di card
        content.innerHTML = `
            <h3>${title}</h3>
            <p class="article-date">${dateString}</p>
        `;

        link.appendChild(image);
        link.appendChild(content);
        return link;
    }

    function createQuickNav(categories) {
      // ... (Fungsi createQuickNav dipertahankan, namun akan diperbarui dalam Logika Utama) ...
      const quickNav = document.getElementById('quick-nav');
      quickNav.innerHTML = '';

      // Tambahkan 'Artikel Terbaru' secara manual di awal
      const allNavItems = [{ name: "Artikel Terbaru", icon: "ðŸ”¥", cls: "latest", url: '#terbaru' }];

      // Tambahkan Sitemap
      allNavItems.push({ name: "Daftar Isi", icon: "ðŸ“‘", cls: "sitemap", url: 'https://frijal.github.io/sitemap.html' });

      // Tambahkan Kategori Dinamis
      categories.forEach(categoryName => {
        const { icon, cls } = getIconAndClass(categoryName);
        const categoryId = categoryToId(categoryName);
        allNavItems.push({ name: categoryName, icon: icon, cls: cls, url: `#${categoryId}` });
      });

      // Tambahkan RSS dan Atas
      allNavItems.push({ name: "RSS Feed", icon: "ðŸ“°", cls: "rss", url: 'https://frijal.github.io/rss' });
      allNavItems.push({ name: "Kembali ke atas", icon: "â†‘â†‘", cls: "up", url: '#top' });


      allNavItems.forEach(item => {
        const button = document.createElement('a');
        button.href = item.url;
        button.className = `nav-button ${item.cls}`;
        button.title = item.name;
        button.innerHTML = `<span class="nav-icon">${item.icon}</span>`;

        if (item.url.startsWith('#')) {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = item.url.substring(1);
                const targetElement = document.getElementById(targetId);

                if (targetId === 'top') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });
                }
            });
        }
        quickNav.appendChild(button);
      });
    }

    // --- Logika Utama (Diubah Total) ---
    document.addEventListener('DOMContentLoaded', async () => {
        const mainContainer = document.getElementById('main-container');
        const categories = [];
        
        try {
            const response = await fetch('artikel.json');
            if (!response.ok) throw new Error('Gagal memuat artikel.json');
            const data = await response.json();

            let allArticles = [];

            // 1. Kumpulkan semua artikel dari semua kategori dan tambahkan tanggalnya (item[3])
            for (const category in data) {
                if (data.hasOwnProperty(category)) {
                    categories.push(category);
                    data[category].forEach(item => {
                        // Cek dan tambahkan tanggal yang valid
                        const dateValue = item[IDX_DATE];
                        if (dateValue) {
                            allArticles.push({
                                // Simpan seluruh array item asli
                                item: item, 
                                // Gunakan objek Date untuk pengurutan yang akurat (penting untuk format ISO Date)
                                date: new Date(dateValue) 
                            });
                        }
                    });
                }
            }
            
            // 2. Urutkan semua artikel berdasarkan tanggal (terbaru ke terlama)
            // b.date - a.date menghasilkan urutan DESCENDING (Terbaru dulu)
            allArticles.sort((a, b) => b.date - a.date);

            // --- Bagian 3: Tampilkan Artikel Terbaru (Global) ---
            if (allArticles.length > 0) {
                const latestSection = document.createElement('section');
                latestSection.classList.add('category-section');
                
                const latestHeading = document.createElement('h2');
                latestHeading.id = 'terbaru';
                latestHeading.textContent = 'Artikel Terbaru ðŸ”¥';
                latestSection.appendChild(latestHeading);

                const latestGrid = document.createElement('div');
                latestGrid.classList.add('article-grid');
                
                // Tampilkan 12 artikel terbaru secara global
                const maxLatest = 12; 
                allArticles.slice(0, maxLatest).forEach(articleObj => {
                    latestGrid.appendChild(createArticleCard(articleObj.item));
                });
                
                latestSection.appendChild(latestGrid);
                mainContainer.appendChild(latestSection);
            }

            // --- Bagian 4: Tampilkan Artikel Berdasarkan Kategori Asli (Diurutkan) ---
            categories.forEach(category => {
                const articles = data[category];

                // Urutkan artikel di dalam KATEGORI sebelum ditampilkan (terbaru ke terlama)
                articles.sort((a, b) => {
                    const dateA = new Date(a[IDX_DATE]);
                    const dateB = new Date(b[IDX_DATE]);
                    return dateB - dateA;
                });

                const section = document.createElement('section');
                section.classList.add('category-section');

                const categoryId = categoryToId(category);

                const heading = document.createElement('h2');
                heading.id = categoryId;
                heading.textContent = category;
                section.appendChild(heading);

                const grid = document.createElement('div');
                grid.classList.add('article-grid');

                articles.forEach((item) => {
                    grid.appendChild(createArticleCard(item));
                });

                section.appendChild(grid);
                mainContainer.appendChild(section);
            });

            // 5. Bangun navigasi cepat
            createQuickNav(categories);
            
        } catch (error) {
            console.error('Ada masalah saat memuat artikel.json:', error);
            mainContainer.innerHTML = `<p style="text-align: center; color: red;">Maaf, gagal memuat daftar artikel. (${error.message})</p>`;
        }
    });
  </script>
</body>
</html>
