<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frijal Artikel - Virtual Scroll Grid</title>
<meta name="description" content="Portal artikel Frijal dengan ribuan konten, update harian, cepat, dan responsive.">
<link rel="canonical" href="https://frijal.github.io/sitemap.html">
<link rel="icon" href="https://frijal.github.io/favicon.png">

<style>
body, html { margin:0; padding:0; font-family:'Segoe UI',Arial,sans-serif; background:#f2f2f2; color:#333; height:100%; overflow:hidden; }
body.dark { background:#121212; color:#ddd; }

/* Marquee */
#marquee-container { width:100%; background:#ff9800; color:#fff; overflow:hidden; white-space:nowrap; padding:10px; position:fixed; top:0; left:0; z-index:1000; }
#marquee-content { display:inline-block; padding-left:100%; animation:marquee 15s linear infinite; }
@keyframes marquee {0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

/* Search bar */
.search-fixed { position:fixed; top:50px; width:100%; max-width:1200px; display:flex; flex-direction:column; align-items:center; z-index:999; padding:10px; }
#search { width:90%; max-width:600px; padding:10px 40px 10px 10px; border-radius:8px; border:1px solid #ccc; font-size:1rem; }
#clearSearch { position:absolute; right:5px; top:50%; transform:translateY(-50%); border:none; background:transparent; font-size:1.2rem; cursor:pointer; display:none; color:#888; }

/* Grid */
#toc { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:15px; padding:20px; margin-top:120px; height:calc(100vh - 120px); overflow-y:auto; }
body.dark #toc { background:#1b1b1b; }
.article-item { background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column; transition: transform 0.2s; cursor:pointer; }
body.dark .article-item { background:#2a2a2a; box-shadow:0 2px 8px rgba(0,0,0,0.4); }
.article-item:hover { transform:translateY(-5px); }
.article-item img { width:100%; height:180px; object-fit:cover; }
.article-content { padding:10px; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
.article-content h3 { margin:0 0 5px; font-size:1rem; }
.article-content p { font-size:0.85rem; color:#555; margin:0; line-height:1.2em; }
body.dark .article-content p { color:#ccc; }

/* Controls */
#darkToggle { position:fixed; bottom:10px; left:10px; font-size:1.2rem; display:flex; align-items:center; gap:5px; }
a.rss-badge img { width:80px; position:fixed; bottom:5%; right:10px; z-index:999; }

/* Responsive */
@media (max-width:600px){
    .article-item img { height:140px; }
    .article-content h3 { font-size:0.95rem; }
    .article-content p { font-size:0.8rem; }
}
</style>
</head>
<body>

<div id="marquee-container"><div id="marquee-content">Memuat artikel terbaruâ€¦</div></div>

<div class="search-fixed">
  <div style="position:relative; width:100%; max-width:600px;">
    <input type="text" id="search" placeholder="ketik apapun..." autocomplete="off">
    <button id="clearSearch">âœ•</button>
  </div>
</div>

<div id="toc"></div>

<div id="darkToggle">ðŸŒž <input type="checkbox" id="darkSwitch"> ðŸŒ™</div>

<a href="https://frijal.github.io/feed.html" class="rss-badge"
   title="Update harian berisi 30 judul artikel terbaru dari berbagai topik populer.">
   <img src="https://img.shields.io/badge/RSS-Feed-orange?logo=rss&style=plastic" alt="RSS Feed"/>
</a>

<script>
const darkSwitch = document.getElementById('darkSwitch');
darkSwitch.addEventListener('change', ()=>document.body.classList.toggle('dark', darkSwitch.checked));

const searchInput = document.getElementById('search');
const clearBtn = document.getElementById('clearSearch');
const toc = document.getElementById('toc');
let articles = [];
let filtered = [];

// --- Search ---
searchInput.addEventListener('input',()=>{ clearBtn.style.display = searchInput.value ? 'block':'none'; renderGrid(); });
clearBtn.addEventListener('click',()=>{ searchInput.value=''; clearBtn.style.display='none'; renderGrid(); });

// --- Load artikel ---
async function loadArticles(){
    try{
        const res = await fetch('artikel/artikel.json');
        const data = await res.json();
        articles = Object.values(data).flat();
        filtered = articles;
        renderMarquee();
        renderGrid(); // initial render
    }catch(err){
        toc.innerHTML='<p style="text-align:center;margin-top:30px;">Gagal memuat artikel.</p>';
        console.error(err);
    }
}

// --- Virtual Scroll ---
let itemHeight = 280; // perkiraan tinggi per artikel
let buffer = 5; // item buffer di atas & bawah

toc.addEventListener('scroll', renderGrid);

function renderGrid(){
    const keyword = searchInput.value.toLowerCase();
    filtered = articles.filter(a=>a[0].toLowerCase().includes(keyword));

    const scrollTop = toc.scrollTop;
    const viewportHeight = toc.clientHeight;
    const startIndex = Math.floor(scrollTop / itemHeight) - buffer;
    const endIndex = Math.ceil((scrollTop + viewportHeight) / itemHeight) + buffer;

    const visible = filtered.slice(Math.max(0,startIndex), Math.min(filtered.length,endIndex));

    const topPadding = Math.max(0,(startIndex>0?startIndex:0)*itemHeight);
    const bottomPadding = Math.max(0,(filtered.length-(endIndex>0?endIndex:0))*itemHeight);

    toc.innerHTML = `<div style="height:${topPadding}px"></div>` +
        visible.map(a=>`
        <div class="article-item" onclick="window.open('artikel/${a[1]}','_blank')">
            <img data-src="${a[2]}" alt="${a[0]}" class="lazy">
            <div class="article-content">
                <h3>${a[0]}</h3>
                <p>${a[4] || ''}</p>
            </div>
        </div>`).join('') +
        `<div style="height:${bottomPadding}px"></div>`;

    // Lazy load images
    const imgs = toc.querySelectorAll('img.lazy');
    imgs.forEach(img=>{ if(!img.src) img.src=img.dataset.src; });
}

// --- Marquee ---
function renderMarquee(){
    const marqueeContent = document.getElementById('marquee-content');
    const latest = articles.slice(0,5).map(a=>a[0]).join(' â€¢ ');
    marqueeContent.textContent = latest || 'Memuat artikel terbaruâ€¦';
}

loadArticles();
</script>

</body>
</html>

